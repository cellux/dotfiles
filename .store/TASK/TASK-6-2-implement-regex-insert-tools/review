- **What went well:** Added the Tree-sitter validation helper plus `rb-tools--regex-insert` and the `insert_before_regex` / `insert_after_regex` wrappers that obey ripgrep’s Rust flavor and respect the `:line` and `:validate` flags. The tools now operate inside a temp buffer, restore modes, and only write after an optional reparse succeeds.
- **Changes made:** Supplemented `rb-tools.el` with the new helper functions and a suite of ERT regression tests covering success paths, ambiguous/missing matches, and validation failure. Docstrings emphasize the regex flavor and validation behavior. No external dependencies were modified.
- **Learnings:** Anchoring edits by regex and optionally re-parsing protects us from inserting text in the wrong sexp. The existing Tree-sitter helpers made it straightforward to detect validation failures, so I reused them rather than reinventing parsing checks.
- **Reality check:** Could not execute the ERT suite here because `gptel-make-tool` isn’t defined in the minimal Emacs environment used by the harness, so the tests are unrun in this session.
